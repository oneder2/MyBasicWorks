import requests
import jsonpath
import re
import os


#url = "https://www.baidu.com"
#res = session.get(curl)
#cookies = cres.cookies

url = "https://image.baidu.com/search/acjson?tn=resultjson_com&logid=8704331368110187375&ipn=rj&ct=201326592&is=&fp=result&fr=&word=%E4%B8%9C%E6%96%B9project&queryWord=%E4%B8%9C%E6%96%B9project&cl=2&lm=-1&ie=utf-8&oe=utf-8&adpicid=&st=&z=&ic=&hd=&latest=&copyright=&s=&se=&tab=&width=&height=&face=&istype=&qc=&nc=1&expermode=&nojc=&isAsync=&pn=60&rn=30&gsm=3c&1728794676175="

headers = {
    "user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36",
    "host":"image.baidu.com",
    #"cookie": cookies[0]
    "cookie": "BAIDUID=85E07DC02D5C7843BB2B7489D097E580:FG=1; BAIDUID_BFESS=85E07DC02D5C7843BB2B7489D097E580:FG=1; H_WISE_SIDS=110085_603324_307087_613053_614488_618462_618438_619523_619881_620011_619895_620349_620577_621318_621394_610631_620184_621039_622284_622347_614596_620092_622514_622512_622491_1991608_1991636_1991570_311849_1991975_1992000_1992028_622116_615158_1992049_613974_1992044_617083_622907_615806_623077_620301_1991790_622998_623160_622439_623275_623459_620483_623600_617569_623659_612886_623656_612517_623784_623757_621954_1991918_623889_623885_607111_623755_622732_621710_623974_623995_623909_624000_624005_624019_624010_624020_610108_622641_624168_624049_624161_624125_622376_624228_624288_624266_624280_612952_624323_624248_624414_620142_624465_624479_624486_624488_623184_623391; delPer=0; H_WISE_SIDS_BFESS=110085_603324_307087_613053_614488_618462_618438_619523_619881_620011_619895_620349_620577_621318_621394_610631_620184_621039_622284_622347_614596_620092_622514_622512_622491_1991608_1991636_1991570_311849_1991975_1992000_1992028_622116_615158_1992049_613974_1992044_617083_622907_615806_623077_620301_1991790_622998_623160_622439_623275_623459_620483_623600_617569_623659_612886_623656_612517_623784_623757_621954_1991918_623889_623885_607111_623755_622732_621710_623974_623995_623909_624000_624005_624019_624010_624020_610108_622641_624168_624049_624161_624125_622376_624228_624288_624266_624280_612952_624323_624248_624414_620142_624465_624479_624486_624488_623184_623391; BIDUPSID=85E07DC02D5C7843BB2B7489D097E580; PSTM=1728794642; H_PS_PSSID=60852_60886_60875; BA_HECTOR=al05ak8k8ha1ag2h8l2104agbj2tsk1jgmk0l1u; ZFY=zmCoAH6SUYETIISsD97R39Uq8MDfT04MAUFWSjLHM1A:C; PSINO=7; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BDRCVFR[fb3VbsUruOn]=rJZwba6_rOCfAF9pywd; arialoadData=false; BDRCVFR[dG2JNJb_ajR]=mk3SLVN4HKm; userFrom=null; BDRCVFR[-pGxjrCMryR]=mk3SLVN4HKm; ab_sr=1.0.1_OGZiOWNkYWY4YWY1YzdmYmJkNTZiZDVmYmIwYWQ1OWMwNDI4ZDZlOTc2ZDhmMjFhYzBmMWJlZDA1ZmI5YzdmMTg0M2E5YjY4ZGM3YTM0YWViNWJjNTM2ODI1ZGU5MzMzMGY0MTAwOTA4OGMyODlmZjU5ZGU5ODJmYWJjZTRiYTFmYTg5ZTQ0NTgzNmUxZGYzZThjOTJkNDM0NmVlZmY2ZA=="
}

res = requests.get(url, headers = headers)

resJson = res.json()
imgurllist = jsonpath.jsonpath(resJson, '$..thumbURL')

directory = "photos"

try:
    os.mkdir(directory)
    print(f"directory \"{directory}\" has been created successfully.")
except FileExistsError:
    print(f"directory \"{directory}\" has already exists.")
except Exception as e:
    print("fatal error, exit")
    exit()

count = 0

for img in imgurllist:
    name = str(count)
    
    rawTail = re.findall("f=(.*?)\?w=", img)
    if len(rawTail) == 0:
        tail = "webp"
    else:
        tail = rawTail[0].lower()

    imgres = requests.get(img)
    with open(f"{directory}/{name}.{tail}", "wb")as img:
        img.write(imgres.content)
    count += 1

    break






